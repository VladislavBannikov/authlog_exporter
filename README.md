
# Authlog Exporter

Данный экспортер анонсирует следующие prometheus-метрики:
- authlog_login_successful_total (количество успешных логонов)
- authlog_logout_total (количество выходов)
- authlog_login_failed_total (количество неуспешных логонов)

Тип метрик - счетчик
Тег метрик - user

Порт по умолчанию: 9946

Счетчики не сохраняются после рестарта сервиса.

# Установка

Вместе с экспортером поставляется скрипт для его автоматической установки и запуска. Он выполняет:
- создание каталога и копирование исполняемых файлов и конфигов
- установка зависимостей
- настройка сервиса systemd, активация и запуск

Скрипт можно запускать повторно, при этом будет выполнен перезапуск сервиса.
```
sudo bash ./authlog_exporter_installer.sh
```

# Файл конфигурации
Расположение файла конфигурации:
/usr/local/lib/authlog_exporter/authlog_exporter.yml

Параметры и значения по умолчанию:
```
# Ожидание в цикле чтения лога auth.log (сек)
follow_log_sleep_sec: 5

# Расположение конфига rsyslog. Для проверки настроек.
rsyslog_config: /etc/rsyslog.conf

# Порт сервиса из свободного диапазона
# https://github.com/prometheus/prometheus/wiki/Default-port-allocations
port: 9946

# Расположение лога, который парсит сервис
authlog_file: /var/log/auth.log

# Включение отладочных сообщений journalctl
debug: true
```

# Отладка
- установить "debug: true" в конфиге
- включить отслеживание новых сообщений в журнале
```
journalctl -f -a -u authlog_exporter.service
```
- перезапустить сервис
```
systemctl restart authlog_exporter.service
```
# Удаление

Вместе с экспортером поставляется скрипт для автоматического удаления. Он выполняет:
- остановка сервиса
- удаление файлов экспортера, включая конфиг

Установленные зависимости не удаляются.
```
sudo bash ./authlog_exporter_uninstaller.sh
```